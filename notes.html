<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HouseVault â€“ Notes</title>

    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=arrow_back_ios"
    />
    <link rel="stylesheet" href="vault_card.css" />
  </head>

  <body>
    <!-- TOP NAVIGATION -->
    <header class="top-bar">
      <a href="dashboard.html" class="home"
        ><span class="material-symbols-outlined">arrow_back_ios</span
        >HouseVault</a
      >
    </header>

    <!-- PAGE TITLE -->
    <section class="page-title">
      <h1>NOTES</h1>
    </section>

    <!-- SEARCH BAR -->
    <section class="search-section">
      <input
        type="search"
        placeholder="Search notes..."
        aria-label="Search notes"
      />
    </section>
    <!-- NOTES TABLE -->
    <main class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>Notes</th>
            <!-- <th>Category</th> -->
            <th>Last Updated</th>
            <th>Action</th>
          </tr>
        </thead>

        <tbody id="notesTableBody">
          <!-- <tr>
            <td>Doctor Visit Notes</td>          
             <td>Medical</td> 
            <td>Jan 2025</td>                      
            <td>
              <button class="icon-btn">
                <h2
                  style="
                    padding: 6px 14px;
                    border-radius: 20px;
                    font-size: 0.85rem;
                    background: rgba(255, 90, 90, 0.2);
                    color: #ff8c8c;
                  "
                >
                  Remove
                </h2>
              </button>
            </td>
          </tr> -->
        </tbody>
      </table>
    </main>

    <!-- ADD BUTTON -->
    <button class="add" onclick="openPopup()">+</button>

    <!-- ADD POPUP-->
    <div id="popup" class="popup">
      <!-- ADD BOX -->
      <div class="popup_box">
        <h2>NEW RECORD ENTRY</h2>

        <form>
          <!-- TITLE -->
          <div class="field">
            <label for="noteText">Notes</label>
            <input
              type="text"
              id="noteText"
              name="noteText"
              placeholder="Add Notes..."
            />
          </div>

          <!-- CATEGORY + EXPIRY -->
          <div class="row">
            <div class="field">
              <label for="noteCategory">Category</label>
              <select id="noteCategory" name="noteCategory">
                <option value="medical">Medical</option>
                <option value="documents">Documents</option>
                <option value="notes">Notes</option>
                <option value="emergency">Emergency</option>
              </select>
            </div>

            <div class="field">
              <label for="noteDate" name="noteDate">Date</label>
              <input type="date" id="noteDate" />
            </div>
          </div>

          <!-- ACTIONS -->
          <div class="actions">
            <button type="button" class="cancel" onclick="closePopup()">
              Cancel
            </button>
            <button type="button" class="save" onclick="saveRecord()">
              Encrypt & Save
            </button>
          </div>
        </form>
      </div>
    </div>

    <script>
      function openPopup() {
        document.getElementById("popup").style.display = "flex";
      }

      function closePopup() {
        document.getElementById("popup").style.display = "none";
      }
      // function RemoveItem() {
      //   document.getElementById("").style.display = "none";
      // }

      //   storage
      let data = JSON.parse(localStorage.getItem("housevaultData"));

      if (!data || !data.notes) {
        data = {
          medical: [],
          documents: [],
          notes: [],
          emergency: [],
        };
        localStorage.setItem("housevaultData", JSON.stringify(data));
      }

      function saveRecord() {
        const text = document.getElementById("noteText").value.trim();
        const category = document.getElementById("noteCategory").value;
        const date = document.getElementById("noteDate").value;

        if (text === "" || date === "") {
          alert("Please fill all fields");
          return;
        }

        const data = JSON.parse(localStorage.getItem("housevaultData"));

        const newRecord = {
          id: Date.now(), // unique id, used further for remove button
          text: text,
          date: date,
        };

        if (category === "notes") {
          data[category].push(newRecord);
          localStorage.setItem("housevaultData", JSON.stringify(data));
          addToTable(newRecord);
        } else {
          alert("Enter correct category");
        }
        closePopup();
        clearForm();
      }

      // add notes to table on the screen

      function addToTable(record) {
        const tableBody = document.getElementById("notesTableBody");

        const row = document.createElement("tr");
        row.setAttribute("data-id", record.id); // to give the row a unique id  <td>${formatDate(record.date)}</td>

        row.innerHTML = `
    <td>${record.text}</td>
    <td>${record.date}</td>           
    
    <td>
      <button class="remove-btn icon-btn" style="
                    padding: 6px 14px;
                    border-radius: 20px;
                    font-size: 0.85rem;
                    background: rgba(255, 90, 90, 0.2);
                    color: #ff8c8c;
                  " onclick="removeNote(${record.id})">Remove</button>
    </td>`;

        tableBody.appendChild(row);
      }

      //load stored notes on screen

      function loadNotes() {
        const data = JSON.parse(localStorage.getItem("housevaultData"));
        if (!data) return; //if data is null or undefined exit the function

        data.notes.forEach(addToTable); //For each element(every note) stored in localStorage, add it as a row in the table
      }

      //other functions

      // function formatDate(dateStr) {
      //   const date = new Date(dateStr);
      //   return date.toLocaleString("en-US", {
      //     date:"numeric",
      //     month: "short",
      //     year: "numeric",
      //   });
      // }

      function clearForm() {
        document.getElementById("noteText").value = "";
        document.getElementById("noteDate").value = "";
      }

      //REMOVE ITEM

      function removeNote(id) {
        const data = JSON.parse(localStorage.getItem("housevaultData"));
        //  Remove from localStorage
        for (let i = 0; i < data.notes.length; i++) {
          if (data.notes[i].id === id) {
            data.notes.splice(i, 1); // delete that note which has that id whose remove btn is clicked(index, no. of elem to be del)
            break;
          }
        }
        localStorage.setItem("housevaultData", JSON.stringify(data)); //store modifies data

        //  Remove from screen
        const row = document.querySelector(`tr[data-id="${id}"]`);
        if (row) {
          row.remove();
        }
      }
      //to load notes when page is refreshed
      window.onload = loadNotes();
    </script>
  </body>
</html>
